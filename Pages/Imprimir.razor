@page "/Imprimir"
@using Dent.Models
<h3>Imprimir</h3>

<div class="form-group">
    <label for="inputText">% en 3 Cuotas:</label>
    <input type="text" id="inputText" @bind="TresCuotasPorcentaje" />
</div>
<div class="form-group">
    <label for="inputText">% en 6 Cuotas:</label>
    <input type="text" id="inputText" @bind="SeisCuotasPorcentaje" />


</div>

<h3>Tabla de Practicas</h3>

<br />

<input type="text" id="inputText" @bind="Titulos[0]" readonly />
<input type="text" id="inputText" @bind="Titulos[1]" size="8" readonly />
<input type="text" id="inputText" @bind="Titulos[2]" size="8" readonly />
<input type="text" id="inputText" @bind="Titulos[3]" size="8" readonly />
<input type="text" id="inputText" @bind="Titulos[4]" size="8" readonly />
<br />
<br />

<input type="text" id="inputText" @bind="PracticasArreglo[0]" readonly />
<input type="text" id="inputText" @bind="PrecioArreglo[0]" size="8" readonly />
<input type="text" id="inputText" @bind="EfectivoArreglo[0]" size="8" readonly />
<input type="text" id="inputText" @bind="TresCuotasArreglo[0]" size="8" readonly />
<input type="text" id="inputText" @bind="SeisCuotasArreglo[0]" size="8" readonly />
<button @onclick="() => EliminarFIla1(1)">X</button>
<br />

<input type="text" id="inputText" @bind="PracticasArreglo[1]" readonly />
<input type="text" id="inputText" @bind="PrecioArreglo[1]" size="8" readonly />
<input type="text" id="inputText" @bind="EfectivoArreglo[1]" size="8" readonly />
<input type="text" id="inputText" @bind="TresCuotasArreglo[1]" size="8" readonly />
<input type="text" id="inputText" @bind="SeisCuotasArreglo[1]" size="8" readonly />
<button @onclick="() => EliminarFIla1(2)">X</button>
<br />

<input type="text" id="inputText" @bind="PracticasArreglo[2]" readonly />
<input type="text" id="inputText" @bind="PrecioArreglo[2]" size="8" readonly />
<input type="text" id="inputText" @bind="EfectivoArreglo[2]" size="8" readonly />
<input type="text" id="inputText" @bind="TresCuotasArreglo[2]" size="8" readonly />
<input type="text" id="inputText" @bind="SeisCuotasArreglo[2]" size="8" readonly />
<button @onclick="() => EliminarFIla1(3)">X</button>
<br />

<input type="text" id="inputText" @bind="PracticasArreglo[3]" readonly />
<input type="text" id="inputText" @bind="PrecioArreglo[3]" size="8" readonly />
<input type="text" id="inputText" @bind="EfectivoArreglo[3]" size="8" readonly />
<input type="text" id="inputText" @bind="TresCuotasArreglo[3]" size="8" readonly />
<input type="text" id="inputText" @bind="SeisCuotasArreglo[3]" size="8" readonly />
<button @onclick="() => EliminarFIla1(4)">X</button>
<br />

<input type="text" id="inputText" @bind="PracticasArreglo[4]" readonly />
<input type="text" id="inputText" @bind="PrecioArreglo[4]" size="8" readonly />
<input type="text" id="inputText" @bind="EfectivoArreglo[4]" size="8" readonly />
<input type="text" id="inputText" @bind="TresCuotasArreglo[4]" size="8" readonly />
<input type="text" id="inputText" @bind="SeisCuotasArreglo[4]" size="8" readonly />
<button @onclick="() => EliminarFIla1(5)">X</button>
<br />

<input type="text" id="inputText" @bind="TotalLabel" readonly />
<input type="text" id="inputText" @bind="TotalDebito" size="8" readonly />
<input type="text" id="inputText" @bind="TotalEfectivo" size="8" readonly />
<input type="text" id="inputText" @bind="Total3Cuotas" size="8" readonly />
<input type="text" id="inputText" @bind="Total6Cuotas" size="8" readonly />
<br />
<br />
<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Practica</th>
            <th>Precio</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var practica in ListaDePracticas)
        {
            <tr>
                <td>@practica.Id</td>
                <td>@practica.Practica</td>
                <td>@practica.Precio</td>
                <td>
                    <button @onclick="() => Agregar(practica.Id)">Agregar</button>
                </td>
            </tr>
        }
    </tbody>
</table>
@code {
    // VARIABLES DE LA ULTIMA LINEA DE LA TABLA HARCODEADA//
    public string TotalLabel = "TOTAL:";

    public int TotalDebito = 0;
    public int TotalEfectivo = 0;
    public int Total3Cuotas = 0;
    public int Total6Cuotas = 0;
    /////////////////////////////////////////////////////////
    public int TresCuotasPorcentaje = 30;
    public int SeisCuotasPorcentaje = 60;
    string[] Titulos = { "PRACTICA", "DEBITO", "EFECTIVO", "3 CUOTAS", "6 CUOTAS" };
    string[] PracticasArreglo = { "-", "-", "-", "-", "-" };
    int[] TresCuotasArreglo = { 0, 0, 0, 0, 0 }; 
    int[] SeisCuotasArreglo = { 0, 0, 0, 0, 0 };
    int[] PrecioArreglo = { 0, 0, 0, 0, 0 };
    int[] EfectivoArreglo = { 0, 0, 0, 0, 0 };
    public int TresCuotas = 0;
    public int SeisCuotas = 0;
    public int Efectivo20Menos = 0;
    private List<Practica1> ListaDePracticas = new List<Practica1>();

    [Inject]
    private DbDentistaContext DbContext { get; set; }

    protected override void OnInitialized()
    {
        ListaDePracticas = DbContext.Practicas.ToList();
    }

    public (int,int,int) ObtenerResultados(int PrecioPasado)
    {
        Efectivo20Menos = Convert.ToInt32(PrecioPasado * 0.8);
        TresCuotas = Convert.ToInt32(((PrecioPasado * TresCuotasPorcentaje) / 100) + PrecioPasado);
        SeisCuotas = Convert.ToInt32(((PrecioPasado * SeisCuotasPorcentaje) / 100) + PrecioPasado);
        var asd = (Efectivo20Menos, TresCuotas, SeisCuotas);
        var sda = asd.GetType();
        return asd;
    }
    public void CargarTotales()
    {
        TotalDebito = PrecioArreglo[0] + PrecioArreglo[1] + PrecioArreglo[2] + PrecioArreglo[3] + PrecioArreglo[4];
        //    TotalEfectivo = EfectivoArreglo[0] + EfectivoArreglo[1] + EfectivoArreglo[2] + EfectivoArreglo[3] + EfectivoArreglo[4];
        TotalEfectivo = 0;
        foreach (int p in EfectivoArreglo)
        {
            TotalEfectivo = TotalEfectivo + p;
        }
        Total3Cuotas = TresCuotasArreglo[0] + TresCuotasArreglo[1] + TresCuotasArreglo[2] + TresCuotasArreglo[3] + TresCuotasArreglo[4];
        Total6Cuotas = SeisCuotasArreglo[0] + SeisCuotasArreglo[1] + SeisCuotasArreglo[2] + SeisCuotasArreglo[3] + SeisCuotasArreglo[4];

    }
    private void EliminarFIla1(int FilaAEliminar)
    {
        if (FilaAEliminar == 1)
        {
            PracticasArreglo[0] = "-";
            PrecioArreglo[0] = 0;
            ObtenerResultados(0);
            EfectivoArreglo[0] = Efectivo20Menos;
            TresCuotasArreglo[0] = 0;
            SeisCuotasArreglo[0]= SeisCuotas;

        }
        else if (FilaAEliminar == 2)
        {
            PracticasArreglo[1] = "-";
            PrecioArreglo[1] = 0;
            ObtenerResultados(0);
            EfectivoArreglo[1] = Efectivo20Menos;
            TresCuotasArreglo[1] = 0;
            SeisCuotasArreglo[1] = SeisCuotas;
        }
        else if (FilaAEliminar == 3)
        {  
            PracticasArreglo[2] = "-";
            PrecioArreglo[2] = 0;
            ObtenerResultados(0);
            EfectivoArreglo[2] = Efectivo20Menos;
            TresCuotasArreglo[2] = 0;
            SeisCuotasArreglo[2] = SeisCuotas;
        }
        else if (FilaAEliminar == 4)
        { 
            PracticasArreglo[3] = "-";
            PrecioArreglo[3] = 0;
            ObtenerResultados(0);
            EfectivoArreglo[3] = Efectivo20Menos;
            TresCuotasArreglo[3] = 0;
            SeisCuotasArreglo[3] = SeisCuotas;
        }
        else if (FilaAEliminar == 5)
        {
            PracticasArreglo[4] = "-";
            PrecioArreglo[4] = 0;
            ObtenerResultados(0);
            EfectivoArreglo[4] = Efectivo20Menos;
            TresCuotasArreglo[4] = 0;
            SeisCuotasArreglo[4] = SeisCuotas;
        }

        CargarTotales();
    }

    private void Quitar(int practicaId)
    {
    }

    private void Agregar(int practicaId)
    {
        if (PracticasArreglo[0] == "-")
        {


            var practica = DbContext.Practicas.Find(practicaId);

            PracticasArreglo[0] = practica.Practica.ToString();
            PrecioArreglo[0] = Convert.ToInt32(practica.Precio.ToString());

            ObtenerResultados(PrecioArreglo[0]);
            EfectivoArreglo[0] = Efectivo20Menos;
            TresCuotasArreglo[0] = TresCuotas;
            SeisCuotasArreglo[0] = SeisCuotas;
        }
        else if (PracticasArreglo[1] == "-")
        {
            var practica = DbContext.Practicas.Find(practicaId);
            PracticasArreglo[1] = practica.Practica.ToString();
            PrecioArreglo[1] = Convert.ToInt32(practica.Precio.ToString());
            ObtenerResultados(PrecioArreglo[1]);
            EfectivoArreglo[1] = Efectivo20Menos;
            TresCuotasArreglo[1] = TresCuotas;
            SeisCuotasArreglo[1] = SeisCuotas;
        }
        else if (PracticasArreglo[2] == "-")
        {
            var practica = DbContext.Practicas.Find(practicaId);
            PracticasArreglo[2] = practica.Practica.ToString();
            PrecioArreglo[2] = Convert.ToInt32(practica.Precio.ToString());
            ObtenerResultados(PrecioArreglo[2]);
            EfectivoArreglo[2] = Efectivo20Menos;
            TresCuotasArreglo[2] = TresCuotas;
            SeisCuotasArreglo[2] = SeisCuotas;
        }
        else if (PracticasArreglo[3] == "-")
        {
            var practica = DbContext.Practicas.Find(practicaId);
            PracticasArreglo[3] = practica.Practica.ToString();
            PrecioArreglo[3] = Convert.ToInt32(practica.Precio.ToString());
            ObtenerResultados(PrecioArreglo[3]);
            EfectivoArreglo[3] = Efectivo20Menos;
            TresCuotasArreglo[3] = TresCuotas;
            SeisCuotasArreglo[3] = SeisCuotas;

        }
        else if (PracticasArreglo[4] == "-")
        {
            var practica = DbContext.Practicas.Find(practicaId);
            PracticasArreglo[4] = practica.Practica.ToString();
            PrecioArreglo[4] = Convert.ToInt32(practica.Precio.ToString());
            ObtenerResultados(PrecioArreglo[4]);
            EfectivoArreglo[4] = Efectivo20Menos;
            TresCuotasArreglo[4] = TresCuotas;
            SeisCuotasArreglo[4] = SeisCuotas;

        }
        CargarTotales();

    }

        
    }

